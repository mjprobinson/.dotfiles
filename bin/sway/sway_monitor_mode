#!/bin/bash

EXTERNAL_OUTPUT=$(swaymsg -t get_outputs -r | jq '.[] | select(.make=="Acer Technologies").name')
INTERNAL_OUTPUT="eDP-1"
TOUCHSCREEN_ID=$(swaymsg -t get_inputs | grep "identifier.*Finger" | awk '{print $2}' | sed s/\[,\"\]//g)

swaymsg input $TOUCHSCREEN_ID map_to_output $INTERNAL_OUTPUT

case "$1" in
    laptop)
        monitor_mode="LAPTOP"
        swaymsg output $INTERNAL_OUTPUT enable transform normal mode 1920x1080@60Hz
        xrandr --output $INTERNAL_OUTPUT --primary
        swaymsg output $EXTERNAL_OUTPUT disable
        ;;
    external)
        monitor_mode="EXTERNAL"
        swaymsg output $EXTERNAL_OUTPUT enable transform normal mode 3840x2160@60Hz scale 2
        xrandr --output $EXTERNAL_OUTPUT --primary
        swaymsg output $INTERNAL_OUTPUT disable
        ;;
    extended)
        monitor_mode="EXTENDED"
        swaymsg output $EXTERNAL_OUTPUT enable transform normal mode 3840x2160@60Hz scale 2 pos 0 0
        swaymsg output $INTERNAL_OUTPUT enable transform normal mode 1920x1080@60Hz
        xrandr --output $EXTERNAL_OUTPUT --primary
        ;;
    inverted)
        monitor_mode="INVERTED"
        swaymsg output $INTERNAL_OUTPUT enable transform 180 mode 1920x1080@60Hz
        xrandr --output $INTERNAL_OUTPUT --primary
        swaymsg output $EXTERNAL_OUTPUT disable
        ;;
    tablet)
        monitor_mode="TABLET"
        swaymsg output $INTERNAL_OUTPUT enable transform 270
        xrandr --output $INTERNAL_OUTPUT --primary
        swaymsg output $EXTERNAL_OUTPUT disable
        ;;
esac

echo "${monitor_mode}" > /tmp/monitor_mode.dat
exit 0
